[circus]
check_delay = 5
endpoint = tcp://127.0.0.1:5555

[watcher:libreoffice]
priority = 1
cmd = /app/soffice-wrapper
args = --listener
autostart = true
respawn = true
stderr_stream.class = StdoutStream
stdin_stream.class = StdoutStream
hooks.after_spawn = preview.circusd.after_spawn


[env:libreoffice]
PYTHONPATH=$PYTHONPATH:/app


[plugin:resource-libreoffice]
use = circus.plugins.resource_watcher.ResourceWatcher
loop_rate = 60
watcher = libreoffice
max_mem = 8G
max_count = 3


[watcher:server]
copy_env = true
priority = 2
working_dir = /app
cmd = /usr/bin/python3
args = -m preview
autostart = false
respawn = true
stderr_stream.class = StdoutStream
stdin_stream.class = StdoutStream


[env:server]
PATH=$PATH

[plugin:httpobserver-server]
use = circus.plugins.http_observer.HttpObserver
loop_rate = 60
check_url = http://localhost:3000/
timeout = 10
restart_on_error = libreoffice


[plugin:resource-server]
use = circus.plugins.resource_watcher.ResourceWatcher
loop_rate = 60
watcher = httpd
max_mem = 2G
max_count = 3


[plugin:flapping]
use = circus.plugins.flapping.Flapping
retry_in = 3
max_retry = 2
